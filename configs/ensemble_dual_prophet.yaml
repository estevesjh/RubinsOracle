# Dual Prophet Ensemble
# High-freq component: sub-daily + daily patterns
# Low-freq component: weekly + bi-weekly + monthly patterns (downsampled to 4h)
#
# This configuration replicates the successful dual Prophet approach
# achieving 40-65% RMSE improvement over baseline.

name: ensemble
lag_days: 60
n_forecast: 2
freq: 15min

# 5-band decomposition (freq as observations per day: 96 = 24 hours / 15min)
decomposer:
  method: bandpass
  freq: 96
  verbose: false
  period_pairs:
    - [0.10, 0.70]    # Band 0: Sub-daily (< 17h)
    - [0.70, 4.00]    # Band 1: Daily (17h - 4d)
    - [4.00, 11.00]   # Band 2: Weekly (4-11d)
    - [11.00, 25.00]  # Band 3: Bi-weekly (11-25d)
    - [25.00, 60.00]  # Band 4: Monthly (25-60d)
  filter_type: savgol
  savgol_polyorder: 3
  edge_method: reflect
  edge_pad_periods: 4.0
  pad_method: none
  nan_fill: periodic
  nan_fill_period: 1.0
  nan_fill_max_gap: 7
  include_residual: false

# Component models
components:
  - name: high_freq
    model_type: prophet
    band_indices: [0, 1]
    resolution: 15min
    lag_days: 7
    seasonalities:
      - name: sub_daily
        period: 0.5
        fourier_order: 10
      - name: daily
        period: 1.0
        fourier_order: 13
    # High-freq: no trend, no changepoints (seasonality only)
    n_changepoints: 0
    changepoint_prior_scale: 0.05
    growth: flat

  - name: low_freq
    model_type: prophet
    band_indices: [2, 3, 4]
    resolution: 15min
    downsample_to: 6h
    # lag_days omitted: inherits from ensemble lag_days_max (60)
    seasonalities:
      - name: weekly
        period: 7.0
        fourier_order: 12
      - name: bi_weekly
        period: 14.0
        fourier_order: 10
      - name: tri_weekly
        period: 21.0
        fourier_order: 13
      # - name: monthly
      #   period: 30.0
      #   fourier_order: 10
      - name: quarterly
        period: 90.00
        fourier_order: 5
    # Low-freq: more changepoints to capture longer patterns
    n_changepoints: 12
    changepoint_prior_scale: 0.85
    growth: linear

# Combination method: sum with bias correction
combine_method: sum

# Post-processing with robust bias correction
post_processor:
  bias_correction: true
  bias_window_hours: 6.0
  bias_method: median
  bias_for_neural_prophet: false
  ets_blend: false

output_freq: 15min
